//go:build !release

// Code generated by ailang. DO NOT EDIT.
// Debug mode: Debug effect operations collect trace data.

package game

// DebugOutput contains collected debug data.
// Matches std/debug/types.ail schema.
type DebugOutput struct {
	Logs       []LogEntry
	Assertions []AssertionResult
}

// LogEntry represents a single debug log entry.
type LogEntry struct {
	Message   string // Log message
	Location  string // Source location (file:line)
	Timestamp int64  // Logical time (host-defined)
}

// AssertionResult represents a single assertion result.
type AssertionResult struct {
	Passed   bool   // Whether assertion passed
	Message  string // Assertion message
	Location string // Source location (file:line)
}

// DebugContext is the host-side Debug effect handler.
// Implements the Debug effect contract: write-only from AILANG,
// host-controlled collection and lifecycle.
type DebugContext struct {
	logs       []LogEntry
	assertions []AssertionResult
	timestamp  int64
}

// NewDebugContext creates a new Debug context.
func NewDebugContext() *DebugContext {
	return &DebugContext{}
}

// SetTimestamp sets the logical timestamp for subsequent operations.
// The meaning of timestamp is host-defined (tick, test index, etc).
func (d *DebugContext) SetTimestamp(t int64) {
	d.timestamp = t
}

// Log records a debug message.
// Location is auto-injected by the AILANG compiler.
func (d *DebugContext) Log(msg, location string) {
	d.logs = append(d.logs, LogEntry{
		Message:   msg,
		Location:  location,
		Timestamp: d.timestamp,
	})
}

// Assert records an assertion result.
// Location is auto-injected by the AILANG compiler.
func (d *DebugContext) Assert(cond bool, msg, location string) {
	d.assertions = append(d.assertions, AssertionResult{
		Passed:   cond,
		Message:  msg,
		Location: location,
	})
}

// Collect returns accumulated debug data.
// HOST-ONLY: Not callable from AILANG code.
func (d *DebugContext) Collect() DebugOutput {
	return DebugOutput{
		Logs:       d.logs,
		Assertions: d.assertions,
	}
}

// Reset clears the debug buffer for the next step.
func (d *DebugContext) Reset() {
	d.logs = d.logs[:0]
	d.assertions = d.assertions[:0]
}

// HasFailedAssertions returns true if any assertions failed.
func (d *DebugContext) HasFailedAssertions() bool {
	for _, a := range d.assertions {
		if !a.Passed {
			return true
		}
	}
	return false
}

// FailedAssertions returns all failed assertions.
func (d *DebugContext) FailedAssertions() []AssertionResult {
	var failed []AssertionResult
	for _, a := range d.assertions {
		if !a.Passed {
			failed = append(failed, a)
		}
	}
	return failed
}
