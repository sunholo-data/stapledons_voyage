// Code generated by ailang. DO NOT EDIT.
package sim_gen

func isInBounds_impl(x interface{}, y interface{}, width interface{}, height interface{}) interface{} {
	return func() interface{} {
		var tmp1 interface{} = GeInt(x, int64(0))
		_ = tmp1 // suppress unused
		return func() interface{} {
			var tmp2 interface{} = LtInt(x, width)
			_ = tmp2 // suppress unused
			return func() interface{} {
				var tmp3 interface{} = func() interface{} {
					if tmp1.(bool) {
						return tmp2
					}
					return false
				}()
				_ = tmp3 // suppress unused
				return func() interface{} {
					var tmp4 interface{} = GeInt(y, int64(0))
					_ = tmp4 // suppress unused
					return func() interface{} {
						var tmp5 interface{} = func() interface{} {
							if tmp3.(bool) {
								return tmp4
							}
							return false
						}()
						_ = tmp5 // suppress unused
						return func() interface{} {
							var tmp6 interface{} = LtInt(y, height)
							_ = tmp6 // suppress unused
							return func() interface{} {
								if tmp5.(bool) {
									return tmp6
								}
								return false
							}()
						}()
					}()
				}()
			}()
		}()
	}()
}

func IsInBounds(x int64, y int64, width int64, height int64) bool {
	return isInBounds_impl(x, y, width, height).(bool)
}

func directionDx_impl(dir interface{}) interface{} {
	return func() interface{} {
		_scrutinee := dir
		_ = _scrutinee // suppress unused
		_adt := _scrutinee.(*Direction)
		switch _adt.Kind {
		case DirectionKindNorth:
			return int64(0)
		case DirectionKindSouth:
			return int64(0)
		case DirectionKindEast:
			return int64(1)
		case DirectionKindWest:
			return NegInt(int64(1))
		default:
			panic("non-exhaustive match")
		}
	}()
}

func directionDx(dir *Direction) int64 {
	return directionDx_impl(dir).(int64)
}

func directionDy_impl(dir interface{}) interface{} {
	return func() interface{} {
		_scrutinee := dir
		_ = _scrutinee // suppress unused
		_adt := _scrutinee.(*Direction)
		switch _adt.Kind {
		case DirectionKindNorth:
			return NegInt(int64(1))
		case DirectionKindSouth:
			return int64(1)
		case DirectionKindEast:
			return int64(0)
		case DirectionKindWest:
			return int64(0)
		default:
			panic("non-exhaustive match")
		}
	}()
}

func directionDy(dir *Direction) int64 {
	return directionDy_impl(dir).(int64)
}

func indexToDirection_impl(idx interface{}) interface{} {
	return func() interface{} {
		var tmp7 interface{} = ModInt(idx, int64(4))
		_ = tmp7 // suppress unused
		return func() interface{} {
			_scrutinee := tmp7
			_ = _scrutinee // suppress unused
			switch _scrutinee {
			case int64(0):
				return NewDirectionNorth()
			case int64(1):
				return NewDirectionSouth()
			case int64(2):
				return NewDirectionEast()
			default:
				return NewDirectionWest()
			}
		}()
	}()
}

func indexToDirection(idx int64) *Direction {
	return indexToDirection_impl(idx).(*Direction)
}

func pathLength_impl(path interface{}) interface{} {
	return Length(path)
}

func pathLength(path []*Direction) int64 {
	return pathLength_impl(path).(int64)
}

func pathGet_impl(path interface{}, idx interface{}) interface{} {
	return func() interface{} {
		var tmp8 interface{} = GetOpt(path, idx)
		_ = tmp8 // suppress unused
		return func() interface{} {
			_scrutinee := tmp8
			_ = _scrutinee // suppress unused
			_adt := _scrutinee.(*Option)
			switch _adt.Kind {
			case OptionKindSome:
				dir := _adt.Some.Value0
				_ = dir // suppress unused
				return dir
			default:
				none := _adt
				_ = none // suppress unused
				return NewDirectionNorth()
			}
		}()
	}()
}

func pathGet(path []*Direction, idx int64) *Direction {
	return pathGet_impl(path, idx).(*Direction)
}

func npcWithPos_impl(npc interface{}, newX interface{}, newY interface{}) interface{} {
	return func() interface{} {
		var tmp9 interface{} = &Coord{X: newX.(int64), Y: newY.(int64)}
		_ = tmp9 // suppress unused
		return RecordUpdate(npc, map[string]interface{}{"pos": tmp9})
	}()
}

func npcWithPos(npc *NPC, newX int64, newY int64) *NPC {
	return npcWithPos_impl(npc, newX, newY).(*NPC)
}

func npcWithCounter_impl(npc interface{}, counter interface{}) interface{} {
	return RecordUpdate(npc, map[string]interface{}{"moveCounter": counter})
}

func npcWithCounter(npc *NPC, counter int64) *NPC {
	return npcWithCounter_impl(npc, counter).(*NPC)
}

func tryMoveDirection_impl(npc interface{}, dir interface{}, width interface{}, height interface{}) interface{} {
	return func() interface{} {
		var dx interface{} = directionDx_impl(dir)
		_ = dx // suppress unused
		return func() interface{} {
			var dy interface{} = directionDy_impl(dir)
			_ = dy // suppress unused
			return func() interface{} {
				var newX interface{} = func() interface{} {
					var tmp13 interface{} = FieldGet(npc, "pos")
					_ = tmp13 // suppress unused
					return func() interface{} {
						var tmp14 interface{} = FieldGet(tmp13, "x")
						_ = tmp14 // suppress unused
						return AddInt(tmp14, dx)
					}()
				}()
				_ = newX // suppress unused
				return func() interface{} {
					var newY interface{} = func() interface{} {
						var tmp11 interface{} = FieldGet(npc, "pos")
						_ = tmp11 // suppress unused
						return func() interface{} {
							var tmp12 interface{} = FieldGet(tmp11, "y")
							_ = tmp12 // suppress unused
							return AddInt(tmp12, dy)
						}()
					}()
					_ = newY // suppress unused
					return func() interface{} {
						var tmp10 interface{} = isInBounds_impl(newX, newY, width, height)
						_ = tmp10 // suppress unused
						return func() interface{} {
							if tmp10.(bool) {
								return npcWithPos_impl(npc, newX, newY)
							}
							return npc
						}()
					}()
				}()
			}()
		}()
	}()
}

func TryMoveDirection(npc *NPC, dir *Direction, width int64, height int64) *NPC {
	return tryMoveDirection_impl(npc, dir, width, height).(*NPC)
}

func updateRandomWalk_impl(npc interface{}, interval interface{}, width interface{}, height interface{}) interface{} {
	return func() interface{} {
		var tmp15 interface{} = FieldGet(npc, "moveCounter")
		_ = tmp15 // suppress unused
		return func() interface{} {
			var tmp16 interface{} = LeInt(tmp15, int64(0))
			_ = tmp16 // suppress unused
			return func() interface{} {
				if tmp16.(bool) {
					return func() interface{} {
						var dirIndex interface{} = requireRand().RandInt(int64(0), int64(3))
						_ = dirIndex // suppress unused
						return func() interface{} {
							var dir interface{} = indexToDirection_impl(dirIndex)
							_ = dir // suppress unused
							return func() interface{} {
								var movedNpc interface{} = tryMoveDirection_impl(npc, dir, width, height)
								_ = movedNpc // suppress unused
								return npcWithCounter_impl(movedNpc, interval)
							}()
						}()
					}()
				}
				return func() interface{} {
					var tmp17 interface{} = FieldGet(npc, "moveCounter")
					_ = tmp17 // suppress unused
					return func() interface{} {
						var tmp18 interface{} = SubInt(tmp17, int64(1))
						_ = tmp18 // suppress unused
						return npcWithCounter_impl(npc, tmp18)
					}()
				}()
			}()
		}()
	}()
}

func updateRandomWalk(npc *NPC, interval int64, width int64, height int64) *NPC {
	return updateRandomWalk_impl(npc, interval, width, height).(*NPC)
}

func updatePatrol_impl(npc interface{}, path interface{}, width interface{}, height interface{}) interface{} {
	return func() interface{} {
		var len interface{} = pathLength_impl(path)
		_ = len // suppress unused
		return func() interface{} {
			var tmp19 interface{} = LeInt(len, int64(0))
			_ = tmp19 // suppress unused
			return func() interface{} {
				if tmp19.(bool) {
					return npc
				}
				return func() interface{} {
					var tmp20 interface{} = FieldGet(npc, "moveCounter")
					_ = tmp20 // suppress unused
					return func() interface{} {
						var tmp21 interface{} = LeInt(tmp20, int64(0))
						_ = tmp21 // suppress unused
						return func() interface{} {
							if tmp21.(bool) {
								return func() interface{} {
									var dir interface{} = func() interface{} {
										var tmp24 interface{} = FieldGet(npc, "patrolIndex")
										_ = tmp24 // suppress unused
										return pathGet_impl(path, tmp24)
									}()
									_ = dir // suppress unused
									return func() interface{} {
										var movedNpc interface{} = tryMoveDirection_impl(npc, dir, width, height)
										_ = movedNpc // suppress unused
										return func() interface{} {
											var nextIndex interface{} = func() interface{} {
												var tmp22 interface{} = FieldGet(npc, "patrolIndex")
												_ = tmp22 // suppress unused
												return func() interface{} {
													var tmp23 interface{} = AddInt(tmp22, int64(1))
													_ = tmp23 // suppress unused
													return ModInt(tmp23, len)
												}()
											}()
											_ = nextIndex // suppress unused
											return RecordUpdate(movedNpc, map[string]interface{}{"patrolIndex": nextIndex, "moveCounter": int64(20)})
										}()
									}()
								}()
							}
							return func() interface{} {
								var tmp25 interface{} = FieldGet(npc, "moveCounter")
								_ = tmp25 // suppress unused
								return func() interface{} {
									var tmp26 interface{} = SubInt(tmp25, int64(1))
									_ = tmp26 // suppress unused
									return npcWithCounter_impl(npc, tmp26)
								}()
							}()
						}()
					}()
				}()
			}()
		}()
	}()
}

func updatePatrol(npc *NPC, path []*Direction, width int64, height int64) *NPC {
	return updatePatrol_impl(npc, path, width, height).(*NPC)
}

func updateNPC_impl(npc interface{}, width interface{}, height interface{}) interface{} {
	return func() interface{} {
		var tmp27 interface{} = FieldGet(npc, "pattern")
		_ = tmp27 // suppress unused
		return func() interface{} {
			_scrutinee := tmp27
			_ = _scrutinee // suppress unused
			_adt := _scrutinee.(*MovementPattern)
			switch _adt.Kind {
			case MovementPatternKindPatternStatic:
				return npc
			case MovementPatternKindPatternRandomWalk:
				interval := _adt.PatternRandomWalk.Value0
				_ = interval // suppress unused
				return updateRandomWalk_impl(npc, interval, width, height)
			case MovementPatternKindPatternPatrol:
				path := _adt.PatternPatrol.Value0
				_ = path // suppress unused
				return updatePatrol_impl(npc, path, width, height)
			default:
				panic("non-exhaustive match")
			}
		}()
	}()
}

func UpdateNPC(npc *NPC, width int64, height int64) *NPC {
	return updateNPC_impl(npc, width, height).(*NPC)
}

func updateAllNPCs_impl(npcs interface{}, width interface{}, height interface{}) interface{} {
	return func() interface{} {
		_scrutinee := npcs
		_ = _scrutinee // suppress unused
		if ListLen(_scrutinee) == 0 {
			return []interface{}{}
		} else if ListLen(_scrutinee) >= 1 {
			npc := ListHead(_scrutinee)
			_ = npc // suppress unused
			rest := ListTail(_scrutinee)
			_ = rest // suppress unused
			return func() interface{} {
				var tmp28 interface{} = updateNPC_impl(npc, width, height)
				_ = tmp28 // suppress unused
				return func() interface{} {
					var tmp29 interface{} = updateAllNPCs_impl(rest, width, height)
					_ = tmp29 // suppress unused
					return Cons(tmp28, tmp29)
				}()
			}()
		} else {
			panic("non-exhaustive match")
		}
	}()
}

func UpdateAllNPCs(npcs []*NPC, width int64, height int64) []*NPC {
	return ConvertToNPCSlice(updateAllNPCs_impl(npcs, width, height))
}
