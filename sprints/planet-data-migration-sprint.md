# Sprint: Planet Data Migration

**Status:** Ready
**Duration:** 1 day (4 phases)
**Priority:** P1 (Phase 1 Data Models)
**Design Doc:** [planet-data-migration.md](../design_docs/planned/phase1-data-models/planet-data-migration.md)
**Depends on:** starmap-data-model (COMPLETE)

## Goal

Migrate planet data from hardcoded Go (dome_renderer.go) to AILANG. Planets become proper game entities that can have state (civilizations, resources) and respond to game events.

## Success Criteria

- [ ] Planet types defined in AILANG (sim/celestial.ail)
- [ ] Sol system with 8 planets generated by AILANG
- [ ] Planet positions updated by step_system()
- [ ] No hardcoded planet data in Go
- [ ] Orbital animation works correctly
- [ ] Planets render from AILANG state

---

## Phase 1: AILANG Types (~2 hours)

### Task 1.1: Create celestial.ail
**File:** `sim/celestial.ail` (NEW)

```ailang
module sim/celestial

type PlanetType = Rocky | GasGiant | IceGiant | Terrestrial | Ocean | Volcanic | Dwarf
type Planet = { id: int, name: string, planet_type: PlanetType, ... }
type StarSystem = { id: int, name: string, star_type: StarType, planets: [Planet] }
```

- [ ] Create `sim/celestial.ail` with PlanetType ADT
- [ ] Add Planet record type (id, name, orbit_distance, radius, etc.)
- [ ] Add StarSystem record type
- [ ] Add StarType ADT (MainSequence, Giant, WhiteDwarf, etc.)
- [ ] Run `ailang check sim/celestial.ail`

### Task 1.2: Color and Helper Functions
**File:** `sim/celestial.ail`

- [ ] Add `planet_base_color(pt: PlanetType) -> Color` function
- [ ] Add `atmosphere_tint(planet: Planet) -> Option(Color)` function
- [ ] Add Color record type `{ r: int, g: int, b: int, a: int }`

### Task 1.3: Sol System
**File:** `sim/celestial.ail`

- [ ] Add `init_sol_system() -> StarSystem` function
- [ ] Define all 8 planets (Mercury through Neptune)
- [ ] Include accurate orbital distances and radii
- [ ] Run `ailang check`

**Phase 1 Test:**
```bash
ailang check sim/celestial.ail
make sim
go build ./...
```

---

## Phase 2: World Integration (~1.5 hours)

### Task 2.1: Add StarSystem to World
**File:** `sim/world.ail`

- [ ] Import celestial types
- [ ] Add `current_system: Option(StarSystem)` to World type
- [ ] Update init_world to include Sol system

### Task 2.2: Orbital Mechanics
**File:** `sim/celestial.ail`

- [ ] Add `step_planet_orbit(planet: Planet, dt: float) -> Planet`
- [ ] Add `step_system(system: StarSystem, dt: float) -> StarSystem`
- [ ] Angular velocity = 2Ï€ / orbital_period

### Task 2.3: Step Integration
**File:** `sim/step.ail`

- [ ] Import celestial step function
- [ ] Call step_system in world step
- [ ] Pass dt for orbital animation

**Phase 2 Test:**
```bash
make sim && go build ./...
```

---

## Phase 3: Rendering (~1.5 hours)

### Task 3.1: Planet DrawCmds
**File:** `sim/celestial.ail` or `sim/step.ail`

- [ ] Add `render_planets(system: StarSystem, scale: float) -> [DrawCmd]`
- [ ] Convert orbital position to screen coordinates
- [ ] Use Circle or Planet3D DrawCmd
- [ ] Handle rings for Saturn/Uranus

### Task 3.2: Engine Integration
**File:** `engine/view/dome_renderer.go` or `planet_layer.go`

- [ ] Remove hardcoded `createSolarSystem()` data
- [ ] Receive planets from AILANG state
- [ ] Render using AILANG-provided positions and colors

### Task 3.3: Wire Up Rendering
**File:** `engine/view/`

- [ ] Pass StarSystem to renderer
- [ ] Call AILANG render_planets or use planet data directly
- [ ] Verify orbital animation works

**Phase 3 Test:**
```bash
make run
# Verify planets orbit, colors match spectral types
```

---

## Phase 4: Verification (~1 hour)

### Task 4.1: Visual Verification
- [ ] Mercury closest to center, Neptune furthest
- [ ] Saturn has rings
- [ ] Earth is blue-green (Terrestrial)
- [ ] Jupiter/Saturn larger than others (GasGiant)
- [ ] Orbital speeds: Mercury fastest, Neptune slowest

### Task 4.2: Cleanup
- [ ] Remove any remaining hardcoded planet data from Go
- [ ] Update imports if needed
- [ ] Run full test suite

### Task 4.3: Demo Update (Optional)
- [ ] Update demo-starmap or create demo-planets to showcase

**Phase 4 Test:**
```bash
go test ./...
bin/demo-starmap  # or demo-planets
```

---

## AILANG Feedback Checkpoint

After sprint completion, report:
- [ ] Bugs encountered during celestial.ail development
- [ ] Features that would have helped (e.g., float math, trig functions)
- [ ] Documentation gaps found

```bash
ailang messages send user "Planet Data Migration sprint complete. Issues: ..." \
  --from "stapledons_voyage" \
  --title "Sprint Complete: Planet Data Migration"
```

---

## Files Created/Modified

### New AILANG Files
| File | LOC | Purpose |
|------|-----|---------|
| `sim/celestial.ail` | ~150 | Planet, StarSystem types + Sol system |

### Modified Files
| File | Changes |
|------|---------|
| `sim/world.ail` | Add current_system field |
| `sim/step.ail` | Call step_system for orbital animation |
| `engine/view/dome_renderer.go` | Remove hardcoded planets |
| `engine/view/planet_layer.go` | Read planets from AILANG state |

---

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Math functions needed (sin/cos) | Med | Use std/math or workaround |
| List operations for planet list | Low | Already working from starmap |
| Record update for orbital state | Low | Fixed in recent AILANG |

---

## References

- [planet-data-migration.md](../design_docs/planned/phase1-data-models/planet-data-migration.md) - Design doc
- [starmap-data-model.md](../design_docs/planned/phase1-data-models/starmap-data-model.md) - Completed starmap sprint
- [sim/starmap.ail](../sim/starmap.ail) - Pattern for celestial types

---

**Document created**: 2025-12-11
