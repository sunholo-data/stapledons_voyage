# Sprint: Planet Data Migration

**Status:** ✅ COMPLETE
**Duration:** 1 day (4 phases)
**Priority:** P1 (Phase 1 Data Models)
**Design Doc:** [planet-data-migration.md](../design_docs/planned/phase1-data-models/planet-data-migration.md)
**Depends on:** starmap-data-model (COMPLETE)

## Goal

Migrate planet data from hardcoded Go (dome_renderer.go) to AILANG. Planets become proper game entities that can have state (civilizations, resources) and respond to game events.

## Success Criteria

- [x] Planet types defined in AILANG (sim/celestial.ail)
- [x] Sol system with 8 planets generated by AILANG
- [x] Planet positions updated by stepSystem()
- [x] No hardcoded planet data in Go
- [x] Orbital animation works correctly
- [x] Planets render from AILANG state

---

## Phase 1: AILANG Types ✅ COMPLETE

### Task 1.1: Create celestial.ail
**File:** `sim/celestial.ail` (398 LOC)

- [x] Create `sim/celestial.ail` with PlanetType ADT
- [x] Add CelestialPlanet record type (id, name, orbit_distance, radius, etc.)
- [x] Add StarSystem record type
- [x] Add StarType/SpectralClass ADTs (O, B, A, F, G, K, M)
- [x] Run `ailang check sim/celestial.ail`

### Task 1.2: Color and Helper Functions
- [x] Add `planetBaseColor(pt: PlanetType) -> Color` function
- [x] Add `atmosphereTint(planet: CelestialPlanet) -> Option[Color]` function
- [x] Add Color record type `{ r: int, g: int, b: int, a: int }`
- [x] Add `packColor(c: Color) -> int` for DrawCmd RGBA

### Task 1.3: Sol System
- [x] Add `initSolSystem() -> StarSystem` function
- [x] Define all 8 planets (Mercury through Neptune)
- [x] Include accurate orbital distances and radii
- [x] Run `ailang check`

---

## Phase 2: World Integration ✅ COMPLETE

### Task 2.1: Add StarSystem to World
**File:** `sim/world.ail`

- [x] Import celestial types
- [x] Add `currentSystem: StarSystem` to World type
- [x] Update init_world to include Sol system

### Task 2.2: Orbital Mechanics
**File:** `sim/celestial.ail`

- [x] Add `stepPlanetOrbit(planet: CelestialPlanet, dt: float) -> CelestialPlanet`
- [x] Add `stepSystem(system: StarSystem, dt: float) -> StarSystem`
- [x] Angular velocity = 2π / orbital_period

### Task 2.3: Step Integration
**File:** `sim/step.ail`

- [x] Import celestial step function
- [x] Call stepSystem in world step
- [x] Pass dt for orbital animation

---

## Phase 3: Rendering ✅ COMPLETE

### Task 3.1: Planet DrawCmds
**File:** `sim/celestial.ail`

- [x] Add `renderPlanets(system: StarSystem, centerX, centerY, scale: float) -> [DrawCmd]`
- [x] Add `renderPlanet2D()` - converts orbital position to screen coordinates
- [x] Add `renderSun()` - sun at center
- [x] Add `renderSolarSystem()` - complete system rendering
- [x] Uses CircleRGBA DrawCmd with planet colors

### Task 3.2: Engine Integration
- [x] Engine receives planets from AILANG state
- [x] Render using AILANG-provided positions and colors

---

## Phase 4: Verification ✅ COMPLETE

### Task 4.1: Visual Verification
- [x] Mercury closest to center, Neptune furthest
- [x] Saturn has rings (hasRings: true, ringColor: Some)
- [x] Earth is blue-green (Terrestrial type)
- [x] Jupiter/Saturn larger than others (GasGiant)
- [x] Orbital speeds: Mercury fastest, Neptune slowest

---

## Implementation Summary

### AILANG Functions Created in `sim/celestial.ail`:

| Function | Purpose |
|----------|---------|
| `packColor` | Convert Color to 0xRRGGBBAA int |
| `planetBaseColor` | Get color for planet type |
| `atmosphereTint` | Optional atmosphere color |
| `makePlanet` | Planet constructor |
| `initSolSystem` | Create Sol with 8 planets |
| `stepPlanetOrbit` | Update orbital position |
| `stepSystem` | Step all planets in system |
| `planetCount` | Get number of planets |
| `getPlanet` | Get planet by index |
| `planetPosition2D` | Convert orbit to screen coords |
| `renderPlanet2D` | Render single planet |
| `renderPlanets` | Render all planets |
| `renderSun` | Render central star |
| `renderSolarSystem` | Complete system render |

### Files Modified

| File | Changes |
|------|---------|
| `sim/celestial.ail` | NEW - 398 LOC, all planet/system types and functions |
| `sim/world.ail` | Added `currentSystem: StarSystem` field |
| `sim/step.ail` | Import/call initSolSystem, stepSystem |

---

**Sprint created:** 2025-12-11
**Sprint completed:** 2025-12-12
**Status:** ✅ COMPLETE
